# 使用指南

## 快速开始

### 1. 下载和安装

#### 方式一：独立版本（推荐新手）
1. 从 [Releases](https://github.com/yourusername/OpenAsMenu/releases/latest) 下载 `OpenAsMenu-*-win-x64-self-contained.zip`
2. 解压到任意目录（建议：`C:\Program Files\OpenAsMenu`）
3. 右键 `OpenAsMenu.exe`，选择"以管理员身份运行"

#### 方式二：依赖版本（推荐开发者）
1. 确保已安装 [.NET 8.0 运行时](https://dotnet.microsoft.com/download/dotnet/8.0)
2. 下载 `OpenAsMenu-*-win-x64-framework-dependent.zip`
3. 解压并以管理员身份运行

### 2. 首次运行

程序启动时会：
- 自动检查管理员权限
- 如无权限，会提示以管理员身份重启
- 加载默认配置文件 `menu_configs.json`

## 主要功能

### 📝 管理右键菜单配置

#### 添加新配置
1. 点击左侧"➕ 添加配置"按钮
2. 填写配置信息：
   - **显示名称**: 右键菜单中显示的文本（如"用 VSCode 打开"）
   - **注册表键名**: 唯一标识符（可留空自动生成）
   - **程序路径**: 点击"📁 浏览"选择可执行文件
   - **应用范围**: 勾选"应用于文件"或不勾选（应用于目录）
3. 点击"💾 保存配置"或"✅ 应用更改"

#### 编辑现有配置
1. 在左侧列表选择要编辑的配置
2. 在右侧修改配置信息
3. 点击"💾 保存配置"（仅保存）或"✅ 应用更改"（保存并更新注册表）

#### 删除配置
1. 选择要删除的配置
2. 点击"🗑️ 删除配置"
3. 确认删除操作

### 🔄 启用/禁用菜单

#### 方式一：通过复选框
1. 选择配置
2. 勾选/取消勾选"启用右键菜单"
3. 自动更新注册表

#### 方式二：通过应用按钮
1. 选择配置
2. 修改配置信息
3. 勾选"启用右键菜单"
4. 点击"✅ 应用更改"

### 🎨 Win11 菜单样式切换

#### 禁用 Win11 一级菜单（显示完整菜单）
1. 点击菜单栏"工具" → "禁用Win11一级菜单"
2. 确认操作
3. 等待资源管理器自动重启
4. 右键查看效果（类似 Win10 完整菜单）

#### 恢复 Win11 默认菜单
1. 点击菜单栏"工具" → "恢复Win11默认菜单"
2. 确认操作
3. 等待资源管理器自动重启
4. 右键查看效果（Win11 简化菜单）

#### 检查菜单状态
- 点击"工具" → "检查菜单状态"
- 查看当前系统信息和菜单状态

### 🔍 其他功能

#### 刷新状态
- 点击"🔄 刷新状态"按钮
- 重新检测所有配置的启用状态

#### 测试路径
- 选择配置
- 点击"🔍 测试路径"
- 验证程序路径是否有效

#### 浏览文件
- 在程序路径输入框旁点击"📁 浏览"
- 选择可执行文件（.exe）

## 配置文件

### 位置
配置文件位于程序目录下：`menu_configs.json`

### 格式
```json
{
  "configs": [
    {
      "name": "VSCode",
      "root": "vscode",
      "path": "C:\\Program Files\\Microsoft VS Code\\Code.exe",
      "for_files": false,
      "enabled": false
    }
  ]
}
```

### 字段说明
- `name`: 显示名称
- `root`: 注册表键名（必须唯一）
- `path`: 程序完整路径
- `for_files`: `true` 应用于文件，`false` 应用于目录
- `enabled`: 是否已启用

### 手动编辑
1. 关闭程序
2. 用文本编辑器打开 `menu_configs.json`
3. 按照格式修改
4. 保存并重新打开程序

## 注册表说明

### 文件右键菜单
```
HKEY_CLASSES_ROOT\*\shell\{root}
├── (默认) = "显示名称"
├── Icon = "程序路径"
└── command
    └── (默认) = "程序路径" "%1"
```

### 目录右键菜单
```
HKEY_CLASSES_ROOT\Directory\shell\{root}
├── (默认) = "显示名称"
├── Icon = "程序路径"
└── command
    └── (默认) = "程序路径" "%V"
```

### Win11 菜单控制
```
HKEY_CURRENT_USER\Software\Classes\CLSID\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\InprocServer32
└── (默认) = "" (空值表示禁用 Win11 一级菜单)
```

## 常见问题

### Q: 为什么需要管理员权限？
A: 修改注册表需要管理员权限，这是 Windows 系统的安全机制。

### Q: 右键菜单没有显示？
A: 
1. 检查配置是否已启用（绿色圆点）
2. 点击"刷新状态"按钮
3. 确认程序路径是否正确
4. 尝试重启资源管理器

### Q: 如何重启资源管理器？
A: 
- 方式一：使用 Win11 菜单切换功能（自动重启）
- 方式二：任务管理器 → 找到"Windows 资源管理器" → 重新启动
- 方式三：`Ctrl+Shift+Esc` → 详细信息 → 结束 explorer.exe → 文件 → 运行新任务 → explorer.exe

### Q: 删除配置后右键菜单还在？
A: 
1. 点击"刷新状态"
2. 如果还在，手动取消勾选"启用右键菜单"
3. 重启资源管理器

### Q: Win11 菜单切换不生效？
A: 
1. 确认系统是 Windows 11（版本 22000+）
2. 确认有管理员权限
3. 手动重启资源管理器
4. 检查注册表是否修改成功

### Q: 程序路径包含中文或空格？
A: 完全支持，程序会自动处理路径引号。

### Q: 如何备份配置？
A: 复制 `menu_configs.json` 文件到安全位置。

### Q: 如何卸载？
A: 
1. 在程序中禁用所有菜单项
2. 删除程序文件夹
3. （可选）手动清理注册表残留

## 高级技巧

### 批量配置
1. 导出 `menu_configs.json`
2. 用文本编辑器批量添加配置
3. 导入并应用

### 自定义图标
注册表中的 `Icon` 值支持：
- 可执行文件路径（使用程序图标）
- ICO 文件路径
- DLL 文件中的图标资源

### 命令行参数
在 `command` 键中可以添加参数：
```
"程序路径" "%1" --custom-arg
```

### 环境变量
路径中可以使用环境变量（需手动编辑注册表）：
```
%ProgramFiles%\VSCode\Code.exe
```

## 安全建议

1. ⚠️ 仅从官方渠道下载程序
2. ⚠️ 修改注册表前建议备份
3. ⚠️ 不要添加不信任的程序路径
4. ⚠️ 定期检查启用的菜单项
5. ⚠️ 使用完整路径，避免路径劫持

## 获取帮助

- 📖 查看 [README.md](../README.md)
- 🐛 提交 [Issue](https://github.com/yourusername/OpenAsMenu/issues)
- 💬 参与 [Discussions](https://github.com/yourusername/OpenAsMenu/discussions)
- 📧 联系开发者

## 贡献

欢迎提交 Bug 报告、功能建议和代码贡献！

查看 [CONTRIBUTING.md](CONTRIBUTING.md) 了解详情。
